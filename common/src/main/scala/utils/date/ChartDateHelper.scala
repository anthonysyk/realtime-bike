package utils.date

import java.text.SimpleDateFormat

import io.circe.syntax._
import io.circe.parser._
import models.Station

object ChartDateHelper {

  val date = new SimpleDateFormat("dd-MM")
  val time = new SimpleDateFormat("HH:mm")
  val datetime = new SimpleDateFormat("dd-MM HH:mm")
  time.setTimeZone(java.util.TimeZone.getTimeZone("GMT+2"))
  date.setTimeZone(java.util.TimeZone.getTimeZone("GMT+2"))
  datetime.setTimeZone(java.util.TimeZone.getTimeZone("GMT+2"))

  def createLabel(timestamps: Seq[Long]) = {
    timestamps.foldLeft(Option.empty[String] -> Seq.empty[String]) { (leftAcc, right) =>
      leftAcc match {
        case (None, acc) =>
          Option(date.format(right)) -> (acc :+ datetime.format(right))
        case (Some(previousDate), acc) if date.format(right) == previousDate =>
          Some(previousDate) -> (acc :+ time.format(right))
        case (Some(previousDate), acc) if date.format(right) != previousDate =>
          Some(date.format(right)) -> (acc :+ datetime.format(right))
      }
    }

  }

  def main(args: Array[String]): Unit = {
    import versatile.json.CirceHelper._
    val data = """[{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":14,"available_bikes":13,"last_update":1538916855000,"state":{"start_date":"07-10-2018 13:53:31","last_update":"07-10-2018 14:54:15","bikes_taken":0,"bikes_droped":1,"availability":56.666666666666664,"counter":60,"counterStateChanged":9}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":13,"available_bikes":14,"last_update":1538920607000,"state":{"start_date":"07-10-2018 14:54:15","last_update":"07-10-2018 15:56:47","bikes_taken":-1,"bikes_droped":1,"availability":53.33333333333333,"counter":60,"counterStateChanged":10}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":11,"available_bikes":16,"last_update":1538923952000,"state":{"start_date":"07-10-2018 15:56:47","last_update":"07-10-2018 16:52:32","bikes_taken":0,"bikes_droped":1,"availability":46.666666666666664,"counter":60,"counterStateChanged":8}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":13,"available_bikes":14,"last_update":1538927802000,"state":{"start_date":"07-10-2018 16:52:32","last_update":"07-10-2018 17:56:42","bikes_taken":-1,"bikes_droped":0,"availability":53.33333333333333,"counter":60,"counterStateChanged":8}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":14,"available_bikes":13,"last_update":1538931266000,"state":{"start_date":"07-10-2018 17:56:42","last_update":"07-10-2018 18:54:26","bikes_taken":-1,"bikes_droped":1,"availability":56.666666666666664,"counter":60,"counterStateChanged":12}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":25,"available_bikes":2,"last_update":1538934982000,"state":{"start_date":"07-10-2018 18:54:26","last_update":"07-10-2018 19:56:22","bikes_taken":-1,"bikes_droped":1,"availability":100,"counter":60,"counterStateChanged":13}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":24,"available_bikes":3,"last_update":1538938509000,"state":{"start_date":"07-10-2018 19:56:22","last_update":"07-10-2018 20:55:09","bikes_taken":-1,"bikes_droped":2,"availability":100,"counter":60,"counterStateChanged":10}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":23,"available_bikes":4,"last_update":1538941817000,"state":{"start_date":"07-10-2018 20:55:09","last_update":"07-10-2018 21:50:17","bikes_taken":0,"bikes_droped":1,"availability":86.66666666666667,"counter":60,"counterStateChanged":7}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":23,"available_bikes":4,"last_update":1538945910000,"state":{"start_date":"07-10-2018 21:50:17","last_update":"07-10-2018 22:58:30","bikes_taken":-1,"bikes_droped":1,"availability":86.66666666666667,"counter":60,"counterStateChanged":9}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":23,"available_bikes":4,"last_update":1538948939000,"state":{"start_date":"07-10-2018 22:58:30","last_update":"07-10-2018 23:48:59","bikes_taken":0,"bikes_droped":0,"availability":86.66666666666667,"counter":60,"counterStateChanged":6}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":23,"available_bikes":4,"last_update":1538952573000,"state":{"start_date":"07-10-2018 23:59:04","last_update":"08-10-2018 00:49:33","bikes_taken":0,"bikes_droped":0,"availability":86.66666666666667,"counter":60,"counterStateChanged":6}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":23,"available_bikes":4,"last_update":1538956208000,"state":{"start_date":"08-10-2018 00:59:39","last_update":"08-10-2018 01:50:08","bikes_taken":0,"bikes_droped":0,"availability":86.66666666666667,"counter":60,"counterStateChanged":6}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":23,"available_bikes":4,"last_update":1538959842000,"state":{"start_date":"08-10-2018 01:50:08","last_update":"08-10-2018 02:50:42","bikes_taken":0,"bikes_droped":0,"availability":86.66666666666667,"counter":60,"counterStateChanged":7}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":23,"available_bikes":4,"last_update":1538963476000,"state":{"start_date":"08-10-2018 02:50:42","last_update":"08-10-2018 03:51:16","bikes_taken":0,"bikes_droped":0,"availability":86.66666666666667,"counter":59,"counterStateChanged":7}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":23,"available_bikes":4,"last_update":1538967110000,"state":{"start_date":"08-10-2018 03:51:16","last_update":"08-10-2018 04:51:50","bikes_taken":0,"bikes_droped":0,"availability":86.66666666666667,"counter":60,"counterStateChanged":7}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":23,"available_bikes":4,"last_update":1538970745000,"state":{"start_date":"08-10-2018 04:51:50","last_update":"08-10-2018 05:52:25","bikes_taken":0,"bikes_droped":0,"availability":86.66666666666667,"counter":60,"counterStateChanged":7}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":22,"available_bikes":5,"last_update":1538974616000,"state":{"start_date":"08-10-2018 05:52:25","last_update":"08-10-2018 06:56:56","bikes_taken":0,"bikes_droped":1,"availability":100,"counter":60,"counterStateChanged":8}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":0,"available_bikes":27,"last_update":1538978317000,"state":{"start_date":"08-10-2018 06:56:56","last_update":"08-10-2018 07:58:37","bikes_taken":-1,"bikes_droped":1,"availability":10,"counter":60,"counterStateChanged":24}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":0,"available_bikes":27,"last_update":1538981461000,"state":{"start_date":"08-10-2018 07:59:16","last_update":"08-10-2018 08:51:01","bikes_taken":-1,"bikes_droped":1,"availability":10,"counter":60,"counterStateChanged":7}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":0,"available_bikes":27,"last_update":1538985486000,"state":{"start_date":"08-10-2018 08:51:01","last_update":"08-10-2018 09:58:06","bikes_taken":-1,"bikes_droped":1,"availability":10,"counter":60,"counterStateChanged":9}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":1,"available_bikes":26,"last_update":1538988663000,"state":{"start_date":"08-10-2018 09:58:06","last_update":"08-10-2018 10:51:03","bikes_taken":-1,"bikes_droped":1,"availability":13.333333333333329,"counter":60,"counterStateChanged":13}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":18,"available_bikes":9,"last_update":1538992689000,"state":{"start_date":"08-10-2018 10:51:03","last_update":"08-10-2018 11:58:09","bikes_taken":-1,"bikes_droped":1,"availability":70,"counter":60,"counterStateChanged":19}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":24,"available_bikes":3,"last_update":1538996133000,"state":{"start_date":"08-10-2018 11:59:10","last_update":"08-10-2018 12:55:33","bikes_taken":-1,"bikes_droped":1,"availability":100,"counter":60,"counterStateChanged":21}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":9,"available_bikes":18,"last_update":1538999531000,"state":{"start_date":"08-10-2018 12:59:33","last_update":"08-10-2018 13:52:11","bikes_taken":-1,"bikes_droped":1,"availability":40,"counter":60,"counterStateChanged":21}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":7,"available_bikes":20,"last_update":1539002984000,"state":{"start_date":"08-10-2018 13:52:11","last_update":"08-10-2018 14:49:44","bikes_taken":-1,"bikes_droped":1,"availability":33.33333333333333,"counter":60,"counterStateChanged":10}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":14,"available_bikes":13,"last_update":1539007075000,"state":{"start_date":"08-10-2018 14:59:50","last_update":"08-10-2018 15:57:55","bikes_taken":-1,"bikes_droped":1,"availability":56.666666666666664,"counter":60,"counterStateChanged":12}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":19,"available_bikes":9,"last_update":1539010741000,"state":{"start_date":"08-10-2018 15:57:55","last_update":"08-10-2018 16:59:01","bikes_taken":-1,"bikes_droped":1,"availability":70,"counter":60,"counterStateChanged":19}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":28,"available_bikes":0,"last_update":1539014184000,"state":{"start_date":"08-10-2018 16:59:06","last_update":"08-10-2018 17:56:24","bikes_taken":-1,"bikes_droped":1,"availability":100,"counter":60,"counterStateChanged":17}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":27,"available_bikes":1,"last_update":1539017689000,"state":{"start_date":"08-10-2018 17:56:24","last_update":"08-10-2018 18:54:49","bikes_taken":-1,"bikes_droped":1,"availability":100,"counter":60,"counterStateChanged":10}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":25,"available_bikes":3,"last_update":1539021507000,"state":{"start_date":"08-10-2018 18:54:49","last_update":"08-10-2018 19:58:27","bikes_taken":-1,"bikes_droped":2,"availability":100,"counter":60,"counterStateChanged":10}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":28,"available_bikes":0,"last_update":1539024902000,"state":{"start_date":"08-10-2018 19:58:27","last_update":"08-10-2018 20:55:02","bikes_taken":-1,"bikes_droped":0,"availability":100,"counter":60,"counterStateChanged":8}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":27,"available_bikes":1,"last_update":1539028533000,"state":{"start_date":"08-10-2018 20:55:02","last_update":"08-10-2018 21:55:33","bikes_taken":0,"bikes_droped":1,"availability":100,"counter":60,"counterStateChanged":7}},{"number":10001,"name":"#10001 - IUT / FEYSSINE","address":"rue de la Technologie","position":{"lat":45.785632,"lng":4.882366},"banking":false,"bonus":false,"status":"OPEN","contract_name":"Lyon","bike_stands":30,"available_bike_stands":27,"available_bikes":1,"last_update":1539031534000,"state":{"start_date":"08-10-2018 21:55:33","last_update":"08-10-2018 22:45:34","bikes_taken":-1,"bikes_droped":1,"availability":100,"counter":50,"counterStateChanged":7}}]"""
    val timestamps = parse(data).getRight.as[Seq[Station]].right.toOption.getOrElse(Nil)
      .map(_.last_update).sorted

    createLabel(timestamps)._2.foreach(println)
  }
}
